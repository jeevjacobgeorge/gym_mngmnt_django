{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EverYouth Gym - Users</title>
    <link rel="stylesheet" href="{% static 'gym/feeDetails.css' %}">
</head>
<body>
    <div class="container">
        <div class="navbar">
            <div class="logo">
                <img src="{% static 'gym/assets/images/Logo.png' %}" alt="Logo">
            </div>
            <nav>
                <a href="{% url 'dashboard' %}"><li><i class="fa-solid fa-house" style="color: #9a9a9a;"></i>Dashboard</li></a>
                <a href="#"><li><i class="fa-solid fa-magnifying-glass" style="color: #9a9a9a;"></i>Search</li></a>
                <a href="/add"><li><i class="fa-solid fa-file"></i>New Customer</li></a>
                <a href="{% url 'feeDetails' %}" style="color:#f4440e;"><li><i class="fa-solid fa-circle-info" style="color: #f4440e;"></i>Fee Details</li></a>
            </nav>
        </div>
        <div class="content">
            <div class="header">
                <h1>Users</h1>
                <div class="userIcon">
                    <a href="{% url 'logout' %}" onclick="alert('Logged out successfully')"><i class="fa-solid fa-power-off" style="color: #c7c7c7;"></i></a>
                </div>
            </div>
            <hr style="color:#9A9A9A">
            <div class="outerContainer">
                <div class="headerButtons">
                    <form method="GET" class="searchForm" id="searchForm">
                        <div class="filters">
                            <input type="text" placeholder="Search" id="customerSearch" class="customerSearch">
                            <select name="gender" id="gender">
                                <option value="select">--Gender--</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                            <select name="activity" id="activity">
                                <option value="select">--Activity--</option>
                                <option value="active">Active</option>
                                <option value="non-active">Non-Active</option>
                            </select>
                        </div>
                    </form>
                    <a href=""><button class="addAlumniButton">Pay Fees</button></a> 
                </div>
                <div class="table-container">
                    <table class="fixed-column">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th class="name">Name</th>
                            </tr>
                        </thead>
                        <tbody id="customer-data">
                            <!-- Customer data will be populated by JavaScript -->
                        </tbody>
                    </table>
                    <div class="scrollable-columns">
                        <table>
                            <thead>
                                <tr>
                                    {% for month in months %}
                                    <th>{{ month }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody id="fee-status">
                                <!-- Fee status data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <table class="last-column">
                        <thead>
                            <tr>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="action-buttons">
                            <!-- Action buttons will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="https://kit.fontawesome.com/570d6d8240.js" crossorigin="anonymous"></script>
    <script>
     document.addEventListener('DOMContentLoaded', function() {
    fetch("{% url 'feeDetails' %}", {
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        const customerData = document.getElementById('customer-data');
        const feeStatus = document.getElementById('fee-status');
        const actionButtons = document.getElementById('action-buttons');

        data.customers.forEach(customerDataObj => {
            // Append customer data
            let customerRow = document.createElement('tr');
            customerRow.innerHTML = `
                <td>${customerDataObj.customer.admission_number}</td>
                <td class="name">${customerDataObj.customer.name}</td>
            `;
            customerData.appendChild(customerRow);

            // Append fee status data
            let feeRow = document.createElement('tr');
            data.months.forEach(month => {
                let statusCell = document.createElement('td');
                if (customerDataObj.fees_status[month]) {
                    statusCell.style.backgroundColor = 'green';
                    statusCell.innerHTML = '<i class="fa-solid fa-check" style="color: white;"></i>';
                } else {
                    statusCell.style.backgroundColor = 'red';
                    statusCell.innerHTML = '<i class="fa-solid fa-times" style="color: white;"></i>';
                }
                feeRow.appendChild(statusCell);
            });
            feeStatus.appendChild(feeRow);

            // Append action buttons
            let actionRow = document.createElement('tr');
            actionRow.innerHTML = `<td><a href="/pay_fees/${customerDataObj.customer.id}">Pay Fees</a></td>`;
            actionButtons.appendChild(actionRow);
        });
    })
    .catch(error => console.error('Error fetching fee details:', error));
});

    </script>
</body>
</html>
